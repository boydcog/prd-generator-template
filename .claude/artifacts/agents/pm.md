# PM 분석: 수학 문제 레벨링 품질 검증

## 스코프 정의

### In-Scope (범위 내)

| # | 항목 | 설명 |
|---|------|------|
| 1 | 기존 채점 체계 검증 | 6차원 가중치(W1~W6) 기반 채점 로직의 정확성 및 일관성 검증 |
| 2 | W-to-C 레벨 매핑 규칙 정의 | W(1~23) → C(1~15) 매핑 공식 또는 룩업 테이블의 명시적 정의 |
| 3 | 데이터 포맷 표준화 | CSV 기반 데이터를 시스템 통합 가능한 구조화 포맷으로 변환 |
| 4 | 학생 데이터 검증 파이프라인 | 실제 학생 학습 데이터와 W/C 레벨 간 상관관계 분석 체계 구축 |
| 5 | 가중치 관리 도구 | 가중치 조정 → 레벨 재계산 → 영향 분석 자동화 도구 |
| 6 | 덧셈/뺄셈 전체 커버리지 | 1~2자리 수 덧셈/뺄셈 약 15,000개 문제의 레벨링 완결성 보장 |

### Out-of-Scope (범위 밖)

| # | 항목 | 사유 |
|---|------|------|
| 1 | 곱셈/나눗셈 확장 | Phase 2 이후. 별도 가중치 체계 설계 필요 |
| 2 | 3자리 수 이상 연산 | Phase 2 이후. W2 자릿수 확장 로직 재설계 필요 |
| 3 | 분수/소수 연산 | Phase 3 이후. 새로운 가중치 차원 추가 필요 |
| 4 | 문장제 유형 분류 | W6 세분화 이후 별도 프로젝트로 진행 |
| 5 | 학습 추천 알고리즘 | 레벨링 검증 완료 후 별도 프로젝트 |
| 6 | UI/UX 구현 | 본 PRD는 레벨링 엔진 백엔드에 한정 |

---

## 기능 요구사항

### FR-01: 채점 엔진

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-01.1 | 6차원 가중치(W1~W6)를 입력받아 W 총점을 계산하는 채점 엔진 구현 | P0 |
| FR-01.2 | W1: 덧셈 0점, 뺄셈 +1.5점 적용 [CLM-003] | P0 |
| FR-01.3 | W2: 동일 자릿수 0점, 비대칭 +1.0점, 자릿수 확장 자릿당 +2.0점 적용 [CLM-004] | P0 |
| FR-01.4 | W3: 0~5 구성 0점, 6~9 포함 개당 +0.5점(최대 1.5점) 적용 [CLM-005] | P0 |
| FR-01.5 | W4: No Carry/Borrow 0점, Single +3.0점, Double/Continuous +5.0점 적용 [CLM-006] | P0 |
| FR-01.6 | W5: 10의 배수 -1.0점, 동일 숫자 반복 -0.5점 감점 적용 [CLM-007] | P0 |
| FR-01.7 | W6: 표현 방식별 가중치 적용 (현재 기본형 0.5점 일률) [CLM-008] | P1 |

### FR-02: 레벨 매핑

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-02.1 | W 총점 → W(1~23) 레벨 매핑 규칙 구현 | P0 |
| FR-02.2 | W 레벨 → C(1~15) 레벨 매핑 규칙 구현 [Q-001] | P0 |
| FR-02.3 | 매핑 규칙을 외부 구성 파일(JSON/YAML)로 관리 | P0 |
| FR-02.4 | 연산 유형별 독립적 매핑 테이블 지원 | P1 |

### FR-03: 데이터 파이프라인

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-03.1 | CSV → 구조화 포맷(JSON) 변환 파이프라인 | P0 |
| FR-03.2 | 입력 데이터 유효성 검증 (범위, 타입, 정합성) | P0 |
| FR-03.3 | 스키마 버저닝 및 하위 호환성 관리 | P1 |
| FR-03.4 | 신규 문제 배치 등록 API | P1 |

### FR-04: 검증 및 품질 관리

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-04.1 | 전체 문제에 대한 레벨 재계산 배치 처리 | P0 |
| FR-04.2 | 가중치 변경 시 영향 분석 리포트 자동 생성 [RSK-004] | P0 |
| FR-04.3 | 학생 데이터(정답률, 풀이 시간) 대비 레벨 상관관계 분석 [Q-004] | P0 |
| FR-04.4 | 레벨 분포 이상 탐지 (편중 경고) | P1 |
| FR-04.5 | 가중치 변경 이력 버전 관리 | P1 |

---

## 비기능 요구사항

| ID | 항목 | 기준 |
|----|------|------|
| NFR-01 | 성능 | 15,000건 전체 레벨 재계산 < 30초 |
| NFR-02 | 확장성 | 문제 수 10만건까지 선형 확장 가능 |
| NFR-03 | 정확성 | 기존 CSV 데이터와 엔진 계산 결과 100% 일치 |
| NFR-04 | 가용성 | 레벨링 API 99.9% 가동률 |
| NFR-05 | 데이터 무결성 | 가중치 변경 시 전체 문제 레벨 자동 재계산 보장 |
| NFR-06 | 감사 추적 | 모든 가중치/레벨 변경에 대한 이력 기록 |
| NFR-07 | 호환성 | 기존 학습 시스템 API와의 통합 인터페이스 제공 |

---

## 마일스톤 및 일정

### Phase 1: 기반 구축 및 검증

| 마일스톤 | 주요 산출물 |
|---------|-----------|
| M1: 데이터 표준화 | CSV → JSON 변환 파이프라인, 스키마 정의, 데이터 유효성 검증 |
| M2: 채점 엔진 MVP | 6차원 가중치 계산 엔진, W 총점 산출, 기존 데이터 100% 일치 검증 |
| M3: 레벨 매핑 구현 | W→C 매핑 규칙 정의 및 구현, 외부 구성 파일 관리 |
| M4: 검증 도구 | 가중치 변경 영향 분석 도구, 레벨 분포 분석 리포트 |

### Phase 2: 학생 데이터 검증

| 마일스톤 | 주요 산출물 |
|---------|-----------|
| M5: 학생 데이터 연동 | 학습 데이터(정답률, 풀이 시간) 수집 파이프라인 |
| M6: 상관관계 분석 | W/C 레벨 vs 실제 학습 성과 통계 분석 (목표: r >= 0.7) |
| M7: 가중치 보정 | 분석 결과 기반 가중치 최적화, A/B 테스트 설계 |

### Phase 3: 확장

| 마일스톤 | 주요 산출물 |
|---------|-----------|
| M8: 곱셈/나눗셈 확장 | W1 가중치 재설계, 신규 채점 규칙, 교육 전문가 검증 |
| M9: 3자리 수 확장 | W2 확장 로직, 3자리 수 문제 데이터셋 |
| M10: 분수/소수 | 새 가중치 차원 설계, 통합 레벨링 체계 |

---

## 수용 기준 (Acceptance Criteria)

### AC-01: 채점 엔진 정확성
- 기존 CSV 데이터 15,000건에 대해 엔진 계산 W 총점이 CSV 기록값과 100% 일치
- W1~W6 각 차원별 독립 검증 통과
- 경계값 테스트: W 총점 0점(최소), 11점(최대) 케이스 포함

### AC-02: 레벨 매핑 정합성
- W(1~23) → C(1~15) 매핑이 기존 데이터와 100% 일치
- 동일 W 레벨 내 C 값 분기 조건이 명시적으로 문서화
- 매핑 규칙 변경 시 전체 레벨 재계산이 30초 이내 완료

### AC-03: 학생 데이터 검증
- 최소 500명 학생의 3개월 학습 데이터 수집
- W/C 레벨과 정답률 간 피어슨 상관계수 r >= 0.7
- 통계적 유의성 p < 0.05

### AC-04: 데이터 파이프라인
- CSV → JSON 변환 무손실 보장 (역변환 후 원본과 바이트 동일)
- 스키마 버전 변경 시 하위 호환 마이그레이션 지원
- 유효하지 않은 입력 데이터에 대한 명확한 에러 리포팅

### AC-05: 가중치 관리
- 가중치 변경 이력 전체 추적 가능 (변경자, 시각, 이전값, 신규값)
- 변경 영향 분석 리포트: 레벨이 변경되는 문제 수, 변경 전후 분포 비교

---

## 의존성

| 의존 대상 | 내용 | 영향 |
|----------|------|------|
| 교육 전문가 자문 | W-to-C 매핑 규칙 정의, 가중치 타당성 검증 | M3, M6 블로킹 |
| 학생 학습 데이터 | 실제 정답률/풀이 시간 데이터 수집 인프라 | M5 블로킹 |
| 학습 관리 시스템(LMS) | 레벨링 API 통합 인터페이스 사양 | M4 이후 통합 |
| 데이터 엔지니어링 팀 | CSV → JSON 변환 파이프라인, 배치 처리 인프라 | M1 블로킹 |
| QA 팀 | 15,000건 전수 검증, 경계값 테스트 | M2 병렬 |
| 채점 기준 원본 관리 | Google Sheets 원본과의 동기화 프로세스 | 전 Phase |

---

## 주요 발견 사항

### 데이터 구조 분석

현재 채점 기준표는 CSV 형식으로 15,050줄, 151개 청크로 구성되어 있다. 각 문제(행)에 대해 문제식, 정답, W1~W6 개별 가중치, W 총점, W 레벨(1~23), C 레벨(1~15)이 기록되어 있다.

**W 총점 분포**: 0점(0+0)부터 11점(99+98 등 연속 올림) 범위이며, W4(절차적 복잡성)가 +3.0~+5.0점으로 난이도 결정에 가장 큰 영향을 미친다. [CLM-006]

**2단계 레벨링**: W 총점을 먼저 W 레벨(1~23)로, 다시 C 레벨(1~15)로 매핑하는 2단계 구조이나, W→C 매핑 규칙이 데이터에서 역추론만 가능하고 명시적 정의가 부재하다. [Q-001]

**특수 패턴**: 10의 배수(-1.0점)와 동일 숫자 반복(-0.5점)에 대한 감점 체계가 심리적 안착점을 반영하고 있으나, 이 감점 값의 교육학적 근거는 확인되지 않았다. [CLM-007, Q-002]

### 확장 과제

곱셈/나눗셈은 W1 헤더에 언급되어 있으나 실제 데이터가 없어, 확장 시 W1 가중치 체계의 전면 재설계가 불가피하다. [CLM-003, RSK-001]
