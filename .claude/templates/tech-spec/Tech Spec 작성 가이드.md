# **Tech Spec 작성 가이드 v1.0**

엔지니어가 추가 질문 없이 구현을 시작할 수 있는 수준의 기술 명세서

* **핵심 질문:** "엔지니어가 추가 질문 없이 구현을 시작할 수 있는가?"
* **프로세스 위치:** Stage 3 초안 → Stage 4 Freeze 완성·확정
* **Gate 연결:** Gate 4 (인계 패키지 완성 — 4종 문서 전원 합의)
* **작성:** 엔지니어 주도 (PM · 디자이너 3자 리뷰 후 확정)
* **데이터 수준:** 확정 (Feasibility PoC 완료 + Product Spec 확정 기반)

## **문서 관계**

| 방향 | 문서 | 읽는 섹션 |
| ----- | ----- | ----- |
| **인풋** | Product Spec §5 (엣지 케이스 & 제약) | 경계 조건 → §3 API 에러 처리, §6 보안 요구사항 |
| **인풋** | Product Spec §6 (데이터 요구사항) | Input/Output 명세 → §4 데이터 모델, §3 API 명세 |
| **인풋** | Product Spec §2 (사용자 스토리) | US → 구현 범위, AC → 테스트 케이스 기준 |
| **인풋** | Design Spec §5 (디자인 토큰) | 기술 스택 확인 (shadcn + Tailwind) |
| **아웃풋** | Gate 4 | 인계 패키지 4종 중 1종 (엔지니어 소유) |
| **아웃풋** | Stage 5 MVP | §5 AI Rules → AI 코딩 도구 가드레일 적용, §3 API → 구현 |

## **섹션 맵**

| \# | 섹션명 | 핵심 질문 | S3 초안 | S4 완성 |
| ----- | ----- | ----- | :---: | :---: |
| 1 | 기술 개요 & 스택 | 무엇으로 만드는가? | **필수** | 확정 |
| 2 | 시스템 아키텍처 | 어떻게 연결되는가? | 골격 | **완성** |
| 3 | API 명세 | 어떤 API가 필요한가? | 목록 | **완성** |
| 4 | 데이터 모델 & 스키마 | 어떤 데이터를 어떻게 저장하는가? | 초안 | **완성** |
| 5 | AI Rules & 가드레일 | AI 코딩 도구에게 무엇을 지시하는가? | — | **필수** |
| 6 | 보안 & 성능 요구사항 | 어떤 기준을 충족해야 하는가? | 선택 | **필수** |
| 7 | 인프라 & 배포 | 어디에 어떻게 배포하는가? | 선택 | **필수** |
| 8 | 기술 리스크 & PoC 결과 | 검증된 기술 리스크는 무엇인가? | **필수** | 확정 |
| 9 | 구현 체크리스트 & Gate 4 | 개발 시작 전 확인 사항 | — | **필수** |

## **1. 기술 개요 & 스택**

이 섹션이 답하는 질문: "무엇으로 만드는가? 왜 이 스택인가?"
인풋: Product Brief §6 (스코프), Feasibility PoC 결과

### **1-1. 기술 스택**

| 레이어 | 기술 | 버전 | 선택 이유 |
| ----- | ----- | ----- | ----- |
| **Frontend** | \[Next.js / React / 기타\] | \[버전\] | \[이유\] |
| **UI** | \[shadcn/ui + Tailwind\] | \[버전\] | \[이유\] |
| **Backend** | \[Next.js API Routes / Express / FastAPI / 기타\] | \[버전\] | \[이유\] |
| **Database** | \[PostgreSQL / SQLite / MongoDB / 기타\] | \[버전\] | \[이유\] |
| **ORM** | \[Prisma / Drizzle / 기타\] | \[버전\] | \[이유\] |
| **Auth** | \[NextAuth / Clerk / Supabase Auth / 기타\] | \[버전\] | \[이유\] |
| **AI** | \[OpenAI / Anthropic / Gemini / 기타\] | \[버전\] | \[이유\] |
| **호스팅** | \[Vercel / AWS / GCP / 기타\] | \[-\] | \[이유\] |
| **패키지 매니저** | \[npm / yarn / pnpm / bun\] | \[버전\] | \[이유\] |

### **1-2. 기술 제약 조건**

| 제약 유형 | 내용 | 영향 |
| ----- | ----- | ----- |
| **규제** | \[HIPAA / GDPR / 국내 의료법 등\] | \[어떤 구현에 영향을 주는가\] |
| **성능** | \[응답시간, 동시 사용자 등\] | \[아키텍처 결정에 영향\] |
| **외부 의존성** | \[필수 외부 API / 서비스\] | \[대안 없는 의존성\] |
| **팀 역량** | \[사용 가능한 기술 스택 제한\] | \[기술 선택 범위\] |

---

## **2. 시스템 아키텍처**

이 섹션이 답하는 질문: "컴포넌트들이 어떻게 연결되는가?"

### **2-1. 전체 아키텍처 다이어그램 (텍스트)**

```
[사용자/클라이언트]
        ↓ HTTPS
[Frontend: Next.js App Router]
   ├── [페이지 컴포넌트]
   ├── [공유 컴포넌트]
   └── [API Routes / Server Actions]
              ↓
[Backend Logic]
   ├── [비즈니스 로직 레이어]
   ├── [데이터 접근 레이어 (ORM)]
   └── [외부 서비스 레이어]
              ↓
[데이터 저장소]
   ├── [Primary DB: PostgreSQL 등]
   └── [캐시: Redis 등 (필요시)]
              ↓
[외부 서비스]
   ├── [AI API: OpenAI / Anthropic 등]
   ├── [인증: Clerk 등]
   └── [기타 외부 API]
```

### **2-2. 레이어별 책임**

| 레이어 | 책임 | 포함되지 않는 것 |
| ----- | ----- | ----- |
| **UI 레이어** | 화면 렌더링, 사용자 입력 처리 | 비즈니스 로직 |
| **API 레이어** | 요청 검증, 응답 형식화 | 직접 DB 접근 |
| **비즈니스 로직** | 도메인 규칙, 워크플로우 | UI 의존성 |
| **데이터 레이어** | DB CRUD, 트랜잭션 | 비즈니스 규칙 |

### **2-3. 데이터 흐름 (핵심 시나리오)**

```
[시나리오: 핵심 기능 실행 흐름]

1. 사용자 → [화면]에서 [액션] 실행
2. [컴포넌트] → API Route /api/[endpoint] POST 요청
3. API Route → 입력 검증 (zod schema)
4. API Route → [비즈니스 서비스].execute()
5. 서비스 → [데이터 레이어].query()
6. 데이터 레이어 → DB 쿼리 → 결과 반환
7. (필요시) 서비스 → 외부 AI API 호출
8. 서비스 → 결과 가공 → API Route 반환
9. API Route → JSON 응답
10. 클라이언트 → UI 업데이트
```

---

## **3. API 명세**

이 섹션이 답하는 질문: "어떤 API 엔드포인트가 필요하고, 어떻게 동작하는가?"
인풋: Product Spec §2 (사용자 스토리) + §6 (데이터 요구사항)

### **3-1. API 엔드포인트 목록**

| Method | Path | 설명 | 인증 필요 | 관련 US |
| ----- | ----- | ----- | ----- | ----- |
| GET | /api/\[리소스\] | \[설명\] | \[Yes/No\] | US-001 |
| POST | /api/\[리소스\] | \[설명\] | \[Yes/No\] | US-002 |
| PUT | /api/\[리소스\]/\[id\] | \[설명\] | \[Yes/No\] | US-003 |
| DELETE | /api/\[리소스\]/\[id\] | \[설명\] | \[Yes/No\] | US-004 |

### **3-2. 주요 엔드포인트 상세**

#### **POST /api/\[리소스\]**

**목적:** \[이 API가 하는 일\]

**요청 (Request)**

```typescript
// Request Body (zod schema)
{
  field1: string,       // [설명]
  field2: number,       // [설명]
  field3?: string,      // [선택적, 설명]
}
```

**응답 (Response)**

```typescript
// 성공 (200)
{
  id: string,
  field1: string,
  createdAt: string,    // ISO 8601
}

// 에러 응답 형식
{
  error: {
    code: string,       // ERROR_CODE
    message: string,    // 사용자 노출 메시지
    details?: any,      // 개발자용 상세 (옵션)
  }
}
```

**에러 코드**

| HTTP | 에러 코드 | 의미 |
| ----- | ----- | ----- |
| 400 | VALIDATION_ERROR | 입력값 유효성 오류 |
| 401 | UNAUTHORIZED | 인증 필요 |
| 403 | FORBIDDEN | 권한 없음 |
| 404 | NOT_FOUND | 리소스 없음 |
| 500 | INTERNAL_ERROR | 서버 오류 |

#### **GET /api/\[리소스\]/\[id\]**

**목적:** \[목적\]

**요청 파라미터:** `id: string` (URL 파라미터)

**응답:** \[응답 형식\]

### **3-3. 인증 & 인가 규칙**

| 항목 | 결정 | 구현 방식 |
| ----- | ----- | ----- |
| **인증 방식** | \[JWT / Session / API Key\] | \[구현 방법\] |
| **세션 만료** | \[시간\] | \[갱신 정책\] |
| **역할 기반 접근** | \[Admin / User / Guest\] | \[미들웨어 / 데코레이터\] |

---

## **4. 데이터 모델 & 스키마**

이 섹션이 답하는 질문: "어떤 데이터를 어떻게 저장하는가?"
인풋: Product Spec §6 (데이터 요구사항)

### **4-1. 핵심 엔티티**

| 엔티티 | 역할 | 관계 |
| ----- | ----- | ----- |
| \[엔티티1\] | \[설명\] | \[다른 엔티티와의 관계\] |
| \[엔티티2\] | \[설명\] | \[관계\] |
| \[엔티티3\] | \[설명\] | \[관계\] |

### **4-2. 데이터 스키마 (Prisma/SQL 형식)**

```prisma
model [엔티티1] {
  id        String   @id @default(cuid())
  [필드1]   String
  [필드2]   Int?
  [필드3]   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  [관계필드] [엔티티2][]
}

model [엔티티2] {
  id        String   @id @default(cuid())
  [필드1]   String
  [외래키]  String
  createdAt DateTime @default(now())

  // Relations
  [관계필드] [엔티티1] @relation(fields: [[외래키]], references: [id])
}
```

### **4-3. 인덱스 & 성능**

| 테이블 | 인덱스 필드 | 이유 |
| ----- | ----- | ----- |
| \[엔티티1\] | \[필드\] | \[자주 조회되는 조건\] |
| \[엔티티2\] | \[필드\] | \[조인 성능\] |

### **4-4. 마이그레이션 전략**

| 항목 | 결정 |
| ----- | ----- |
| **마이그레이션 도구** | \[Prisma Migrate / Flyway / 기타\] |
| **Zero-downtime 전략** | \[Blue-Green / Rolling / 없음\] |
| **롤백 정책** | \[자동 / 수동 스크립트\] |

---

## **5. AI Rules & 가드레일**

이 섹션이 답하는 질문: "AI 코딩 도구가 이 프로젝트의 규칙을 어떻게 따르게 하는가?"
**이 섹션이 Stage 5 MVP에서 AI 코딩 도구(Cursor 등)의 가드레일이 된다.**

### **5-1. 프로젝트 Rules (Cursor / AI 코딩 도구)**

AI 코딩 도구에게 주는 전역 규칙. `.cursor/rules/` 또는 `CLAUDE.md` 등에 저장.

```markdown
# [프로젝트명] AI Rules

## 아키텍처 규칙
- [규칙 1: 예) 모든 DB 접근은 /lib/db/ 레이어를 통해서만]
- [규칙 2: 예) API Routes는 비즈니스 로직을 포함하지 않는다]
- [규칙 3: 예) 컴포넌트는 서버 컴포넌트를 기본으로, 인터랙션이 필요한 경우만 "use client"]

## 코딩 컨벤션
- TypeScript strict 모드. any 타입 금지.
- 함수는 화살표 함수. 클래스 사용 최소화.
- 파일명: kebab-case. 컴포넌트: PascalCase.
- [기타 컨벤션]

## 금지 사항
- [예: 환경 변수를 코드에 하드코딩하지 않는다]
- [예: console.log를 프로덕션 코드에 남기지 않는다]
- [예: any 타입 사용 금지]

## 보안 규칙
- [예: 사용자 입력은 항상 zod로 검증한다]
- [예: SQL은 ORM(Prisma)을 통해서만 실행한다]
- [예: 민감한 정보는 환경 변수에만]

## 테스트 규칙
- [예: 핵심 비즈니스 로직은 단위 테스트 필수]
- [예: API 엔드포인트는 통합 테스트 작성]
```

### **5-2. 도메인별 Rules**

특정 기능/도메인에 대한 세부 Rules. 기능 디렉토리 내 `.cursor/rules/[도메인].md` 등에 저장.

#### **[도메인 1] Rules**

```markdown
## [도메인 1] 구현 규칙

- [규칙 1]
- [규칙 2]
- [규칙 3]

## 이 도메인에서 금지된 것
- [금지 1]
- [금지 2]
```

### **5-3. AI 코딩 워크플로우**

| 단계 | AI 입력 | AI 출력 | 엔지니어 판단 |
| ----- | ----- | ----- | ----- |
| Feature 개발 | Product Spec AC + Tech Spec §5 Rules | 구현 코드 | 아키텍처 결정, 코드 리뷰 |
| API 개발 | §3 API 명세 + §5 Rules | API Route 코드 | 보안 검토, 에러 핸들링 |
| DB 접근 | §4 스키마 + §5 Rules | Prisma 쿼리 | 성능, N+1 방지 |
| 테스트 | 구현 코드 + AC | 테스트 코드 | 경계 케이스 추가 |

---

## **6. 보안 & 성능 요구사항**

이 섹션이 답하는 질문: "어떤 기준을 충족해야 하는가?"
인풋: Product Spec §5 (엣지 케이스 & 제약)

### **6-1. 보안 요구사항**

| 항목 | 요구사항 | 구현 방법 |
| ----- | ----- | ----- |
| **인증** | \[요구사항\] | \[구현 방법\] |
| **인가** | \[역할별 접근 제어\] | \[미들웨어\] |
| **입력 검증** | 모든 API 입력 zod 검증 | zod 스키마 |
| **SQL Injection** | ORM 사용, raw query 금지 | Prisma |
| **XSS** | \[요구사항\] | \[구현 방법\] |
| **민감 데이터** | 환경 변수, 로그 마스킹 | \[구현 방법\] |
| **HTTPS** | 모든 통신 HTTPS | \[인증서 관리\] |

### **6-2. 성능 요구사항**

| 지표 | 목표값 | 측정 방법 |
| ----- | ----- | ----- |
| **API 응답 시간** | \[ms — P95 기준\] | \[측정 도구\] |
| **페이지 로드** | \[LCP ms\] | Lighthouse |
| **동시 사용자** | \[명\] | \[부하 테스트 도구\] |
| **DB 쿼리 시간** | \[ms\] | Prisma 로그 |

### **6-3. 에러 처리 전략**

| 에러 유형 | 처리 방식 | 사용자 노출 |
| ----- | ----- | ----- |
| **입력 오류** | 즉시 반환 + 필드별 메시지 | 구체적 안내 |
| **인증 오류** | 401 반환 + 로그인 페이지 리디렉션 | "다시 로그인 필요" |
| **서버 오류** | 에러 로깅 + 500 반환 | "잠시 후 다시 시도" |
| **외부 API 오류** | 재시도 (3회) + 폴백 | \[폴백 동작\] |

---

## **7. 인프라 & 배포**

이 섹션이 답하는 질문: "어디에 어떻게 배포하는가?"

### **7-1. 환경 구성**

| 환경 | 목적 | URL | 배포 방식 |
| ----- | ----- | ----- | ----- |
| **local** | 개발 | localhost:3000 | `npm run dev` |
| **staging** | QA / 내부 테스트 | \[URL\] | \[방식\] |
| **production** | 실서비스 | \[URL\] | \[방식\] |

### **7-2. 환경 변수**

| 변수명 | 설명 | 필수 | 예시 |
| ----- | ----- | ----- | ----- |
| DATABASE_URL | DB 연결 문자열 | 필수 | `postgresql://...` |
| NEXTAUTH_SECRET | 인증 비밀키 | 필수 | \[랜덤 32자\] |
| \[API_KEY\] | \[외부 서비스 키\] | 필수 | `sk-...` |
| \[변수명\] | \[설명\] | 선택 | \[예시\] |

### **7-3. CI/CD 파이프라인**

| 단계 | 트리거 | 액션 |
| ----- | ----- | ----- |
| **테스트** | PR 생성 | 단위 테스트 + 타입 체크 |
| **빌드** | main 머지 | `npm run build` |
| **배포 (staging)** | main 머지 | \[자동 배포\] |
| **배포 (production)** | 태그 생성 | \[수동 승인 후 배포\] |

---

## **8. 기술 리스크 & PoC 결과**

이 섹션이 답하는 질문: "어떤 기술 리스크가 있었고, 어떻게 검증했는가?"
인풋: Stage 3 Feasibility PoC 결과

### **8-1. PoC 검증 결과**

| 리스크 | 검증 방법 | 결과 | 결정 |
| ----- | ----- | ----- | ----- |
| \[기술 리스크 1\] | \[PoC 방법\] | \[Pass/Fail + 수치\] | \[채택/대안 선택\] |
| \[기술 리스크 2\] | \[검증 방법\] | \[결과\] | \[결정\] |

### **8-2. 잔존 기술 리스크**

| 리스크 | 발생 가능성 | 영향도 | 대응 방안 |
| ----- | ----- | ----- | ----- |
| \[리스크\] | \[상/중/하\] | \[상/중/하\] | \[완화 방법\] |

### **8-3. 외부 의존성**

| 서비스 | 용도 | 대안 | SLA |
| ----- | ----- | ----- | ----- |
| \[외부 서비스\] | \[용도\] | \[대안 없음/있음\] | \[가용성\] |

---

## **9. 구현 체크리스트 & Gate 4**

### **개발 시작 전 확인 (엔지니어)**

- [ ] Product Spec 모든 AC 확인 및 이해 완료
- [ ] 기술 스택 & 의존성 버전 고정 완료 (`package.json` lock)
- [ ] 환경 변수 목록 확정 + `.env.example` 작성 완료
- [ ] DB 스키마 최종 확정 + 초기 마이그레이션 준비
- [ ] AI Rules 파일 위치 및 내용 확정

### **Gate 4 — 인계 전 합의 확인**

| 기준 | 질문 | 판정 |
| ----- | ----- | ----- |
| **완성도** | §1~§8 전 섹션이 완성되었는가? | \[Pass/Fail\] |
| **구현 가능성** | 이 Spec대로 4주 내 구현 가능한가? | \[Pass/Fail\] |
| **Product Spec 정합** | Product Spec AC와 API 명세가 1:1 매핑되는가? | \[Pass/Fail\] |
| **Design Spec 정합** | Design Spec 기술 스택과 §1 스택이 일치하는가? | \[Pass/Fail\] |
| **AI Rules 완성** | §5 AI Rules로 AI 코딩 도구가 가드레일 적용 가능한가? | \[Pass/Fail\] |
| **3자 합의** | PM · 디자이너 · 엔지니어 전원 합의했는가? | \[Pass/Fail\] |

* **판정:** \[Freeze 확정 / 수정 후 재검토\]
* **확정자:** \[이름들\] (날짜: YYYY-MM-DD)
* **확정 후 변경:** 변경 대상, 사유, 영향 범위를 기록하고 PM이 판단한다.
